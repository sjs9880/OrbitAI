<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="utf-8">
    <title>Orbit 설정</title>
    <link rel="stylesheet" href="../../assets/styles/styles.css">
    <!-- FontAwesome for Icons (Optional, using emoji for now) -->
</head>

<body class="options-page">
    <div class="options-container">
        <!-- Header -->
        <header class="options-header">
            <h1>💫 Orbit 설정</h1>
            <p>AI 모델 및 확장 프로그램 동작을 관리하세요.</p>
        </header>

        <div class="options-grid">
            <!-- [NEW] Card 0: Setup Guide (Hidden by default) -->
            <div id="nano-guide-card" class="card"
                style="display: none; background: #fff1f2; border: 1px solid #fecdd3; grid-column: 1 / -1;">
                <div id="guide-card-header" class="card-header"
                    style="cursor: pointer; user-select: none; margin-bottom: 0; border-bottom: none;">
                    <span id="guide-icon" class="icon">🚨</span>
                    <h2 id="guide-title" style="color: #be123c; flex: 1;">Local AI (Gemini Nano) 설정 가이드</h2>
                    <span id="guide-arrow" style="color: #be123c;">▼</span>
                </div>
                <div id="guide-content" class="guide-content"
                    style="font-size: 0.95rem; line-height: 1.6; color: #374151; padding-top: 1.5rem; border-top: 1px solid #fecdd3; display: none;">
                    <p style="margin-bottom: 12px;"><strong>Orbit의 Local AI 기능을 사용하려면 Chrome 설정을 변경해야 합니다.</strong></p>
                    <ol style="padding-left: 20px; margin-bottom: 15px;">
                        <li style="margin-bottom: 8px;">
                            주소창에 <code
                                style="background:#e5e7eb; padding:2px 4px; border-radius:4px;">chrome://flags</code>를
                            입력하고 이동합니다.
                        </li>
                        <li style="margin-bottom: 8px;">
                            <strong>"Enables optimization guide on device"</strong>를 검색하여 <span
                                style="color:#2563eb; font-weight:bold;">Enabled BypassPrefRequirement</span>로 설정합니다.
                        </li>
                        <li style="margin-bottom: 8px;">
                            <strong>"Prompt API for Gemini Nano"</strong>를 검색하여 <span
                                style="color:#2563eb; font-weight:bold;">Enabled</span>로 설정합니다.
                        </li>
                        <li style="margin-bottom: 8px;">
                            브라우저를 <strong>재시작</strong>합니다.
                        </li>
                        <li>
                            재시작 후 배경에서 모델이 다운로드될 때까지 몇 분 정도 소요될 수 있습니다.
                            (<code
                                style="background:#e5e7eb; padding:2px 4px; border-radius:4px;">chrome://components</code>에서
                            <strong>Optimization Guide On Device Model</strong> 확인 가능)
                        </li>
                    </ol>
                    <button id="guide-open-flags" class="btn-primary" style="background: #be123c;">설정 페이지 바로가기
                        (Flags)</button>
                </div>
            </div>

            <!-- Card 1: Cloud AI Settings -->
            <div class="card">
                <div class="card-header">
                    <span class="icon">☁️</span>
                    <h2>Cloud AI 설정</h2>
                </div>

                <div class="input-group">
                    <label class="input-label" for="api-key-input">Google Gemini API Key</label>
                    <input type="password" id="api-key-input" class="styled-input" placeholder="AI Studio에서 발급받은 키 입력">
                    <p class="help-text">
                        API Key는 <a href="https://aistudio.google.com/app/apikey" target="_blank"
                            style="color:#2563eb">Google AI Studio</a>에서 무료로 발급받을 수 있습니다.
                    </p>
                </div>

                <div class="btn-group">
                    <button id="save-key-btn" class="btn-primary">저장하기</button>
                    <button id="clear-key-btn" class="btn-secondary">키 삭제</button>
                </div>
                <div id="key-status-msg" style="margin-top: 10px; font-size: 13px; min-height: 20px;"></div>

                <div class="input-group" style="margin-top: 25px;">
                    <label class="input-label" for="model-select">기본 사용 모델</label>
                    <select id="model-select" class="styled-select">
                        <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
                        <option value="gemini-2.5-flash" selected>Gemini 2.5 Flash</option>
                    </select>
                    <p class="help-text">* Cloud 모드 활성화 시 사용될 모델입니다.</p>
                </div>

            </div>

            <!-- Card 2: Local AI Settings & Test -->
            <div class="card">
                <div class="card-header">
                    <span class="icon">💻</span>
                    <h2>Local AI 연결 관리</h2>
                </div>
                <p style="color: #666; font-size: 0.95rem; line-height: 1.5; margin-bottom: 20px;">
                    브라우저 내장(On-device) AI 모델의 연결 상태를 확인하고 테스트합니다.
                </p>

                <div class="btn-group" style="flex-wrap: wrap;">
                    <button id="test-btn" class="btn-secondary"
                        style="background:#e0f2fe; color:#0369a1; border:none;">테스트 시작</button>
                    <button id="restart-btn" class="btn-secondary">세션 재시작</button>
                    <button id="stop-btn" class="btn-secondary" style="color:#ef4444;" disabled>세션 종료</button>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: #f9fafb; border-radius: 8px;">
                    <div style="font-size: 0.9rem; color: #4b5563; margin-bottom: 5px;">연결 상태</div>
                    <div id="status-text" style="font-weight: 700; color: #6b7280;">대기 중</div>
                </div>

                <div id="log-console"
                    style="margin-top:10px; font-size: 0.8em; color: #666; max-height:100px; overflow-y:auto; border:1px solid #eee; padding:5px; display:none;">
                </div>
            </div>

            <!-- Card 5: General Settings -->
            <div class="card">
                <div class="card-header">
                    <span class="icon">⚙️</span>
                    <h2>일반 설정</h2>
                </div>

                <div class="input-group">
                    <label class="input-label" for="default-mode-select">기본 AI 모드</label>
                    <select id="default-mode-select" class="styled-select">
                        <option value="local">Local AI (Gemini Nano)</option>
                        <option value="cloud">Cloud AI (Gemini API)</option>
                    </select>
                    <p class="help-text">패널을 열 때 기본으로 선택될 AI 모드입니다.</p>
                </div>

                <div class="input-group" style="margin-top: 15px;">
                    <label class="input-label" for="default-tone-select">기본 답변 톤</label>
                    <select id="default-tone-select" class="styled-select">
                        <option value="기본">기본 (친절하게)</option>
                        <option value="정중하게">정중하게 (비즈니스)</option>
                        <option value="친근하게">친근하게 (친구처럼)</option>
                    </select>
                    <p class="help-text">대화 시작 시 적용될 기본 톤 앤 매너입니다.</p>
                </div>
            </div>

            <!-- Card 4: AI Parameters (New) -->
            <div class="card">
                <div class="card-header">
                    <span class="icon">🎛️</span>
                    <h2>AI 매개변수 설정</h2>
                </div>
                <div class="input-group">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <label class="input-label" for="temp-slider">Temperature (창의성)</label>
                        <span id="temp-value" style="font-weight:bold; color:#2563eb;">1.0</span>
                    </div>
                    <input type="range" id="temp-slider" min="0" max="2" step="0.1" value="1.0" class="styled-slider">
                    <p class="help-text">값이 높을수록 더 창의적이고 다양한 답변을 생성합니다. (기본값: 모델 권장값)</p>
                </div>

                <div class="input-group" style="margin-top:20px;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <label class="input-label" for="topk-slider">Top-K (다양성)</label>
                        <span id="topk-value" style="font-weight:bold; color:#2563eb;">3</span>
                    </div>
                    <input type="range" id="topk-slider" min="1" max="100" step="1" value="3" class="styled-slider">
                    <p class="help-text">다음 토큰 선택 시 고려할 후보군의 수입니다.</p>
                </div>

                <div class="btn-group" style="margin-top:10px;">
                    <button id="reset-params-btn" class="btn-secondary" style="font-size: 0.85rem;">기본값 복원</button>
                    <button id="save-params-btn" class="btn-primary" style="font-size: 0.85rem;">설정 저장</button>
                </div>
                <p id="params-status-msg" class="status-msg"></p>
            </div>



            <!-- Card 3: Logs (Full Width) -->
            <div class="card log-container">
                <div class="card-header">
                    <span class="icon">🛠️</span>
                    <h2>대화 로그</h2>
                </div>

                <div class="log-viewer-controls">
                    <div class="log-filters">
                        <button class="filter-btn active" data-filter="ALL">전체</button>
                        <button class="filter-btn" data-filter="SYSTEM">System</button>
                        <button class="filter-btn" data-filter="USER">User</button>
                        <button class="filter-btn" data-filter="ERROR">Error</button>
                    </div>
                    <div class="log-actions">
                        <label class="log-checkbox">
                            <input type="checkbox" id="debug-toggle" style="margin-right: 8px;">
                            로그 기록 활성화
                        </label>
                        <button id="clear-log-btn" class="btn-secondary"
                            style="font-size: 0.85rem; padding: 6px 12px;">로그
                            비우기</button>
                    </div>
                </div>

                <div id="debug-log-viewer" class="log-viewer">
                    <div class="log-placeholder">로그가 여기에 표시됩니다...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="../../assets/lib/marked.min.js"></script> <!-- 로그 렌더링용 (필요시) -->
    <script type="module" src="options.js"></script>
</body>

</html>